<script>
	import { stores } from '@sapper/app';
    import { projectArticles, projectVersions } from 'stores/project';
    import { locale } from 'svelte-i18n';
	import { quintOut } from 'svelte/easing';
    import { slide } from 'svelte/transition';

    export let category;
    export let project;
    export let heading;
    export let latestVersion = '';
    export let index = '';
    export let singleton = false;

    const { page } = stores();

    const slideIn = { delay: 50, duration: 300, easing: quintOut };
    const slideOut = {delay: 100, duration: 300, easing: quintOut };
</script>

{#if singleton}
    <a rel='prefetch' class='heading' href={`/${$locale}/${category}/${project}`}>{heading}</a>
{:else}
    {#if !!latestVersion}
        <a rel='prefetch'class='heading' href={`/${$locale}/${category}/${project}/${latestVersion}/${index}`}>{heading}</a>
        {#if !!$page.params && !!$page.params.project && project === $page.params.project}
            <ol in:slide={slideIn} out:slide={slideOut}>
                {#each $projectVersions as version}
                    <li>
                        <a rel='prefetch' class='version' href={`/${$locale}/${category}/${project}/${version}/${index}`}>{version}</a>
                        {#if !!$page.params && !!$page.params.version && version === $page.params.version}
                            <ol>
                                {#each $projectArticles as article}
                                    <li>
                                        <a class='article' rel='prefetch' href={`/${$locale}/${category}/${project}/${version}/${article.slug}`}>
                                            {article.shortTitle ? article.shortTitle : article.title}
                                        </a>
                                    </li>
                                {/each}
                            </ol>
                        {/if}
                    </li>
                {/each}
            </ol>
        {/if}
    {:else}
        <a rel='prefetch' class='heading' href={`/${$locale}/${category}/${project}/${index}`}>{heading}</a>
        {#if !!$page.params && !!$page.params.project && project === $page.params.project}
            <ol in:slide={slideIn} out:slide={slideOut}>
                {#each $projectArticles as article}
                    <li>
                        <a class='article' rel='prefetch' href={`/${$locale}/${category}/${project}/${article.slug}`}>
                            {article.shortTitle ? article.shortTitle : article.title}
                        </a>
                    </li>
                {/each}
            </ol>
        {/if}
    {/if}
{/if}

<style>
    a {
        display: block;
        padding: 0.5em;
        text-decoration: none;
    }

	ol {
        list-style: none;
		margin: 0 0 0 1rem;
		padding: 0;
    }

    ol ol {
		color: #666;
		text-transform: none;
    }
    
    .heading {
		margin-top: 0;
		padding: 0.5em;
    }
</style>