import { cookieName } from './settings';
import cookie from 'cookie';
import { locale, waitLocale } from 'svelte-i18n';

export default async function localize(page, session) {
    if (!!page.params.locale) {
        locale.set(page.params.locale);
        session.locale = page.params.locale;
    } else {
        locale.set(session.locale);
    }

    const currentLocale =  page.params.locale || session.locale;

    if (typeof document !== 'undefined' && !!document) {
        const localeCookie = cookie.serialize(cookieName, currentLocale);
		document.cookie = localeCookie;
    }

    return await waitLocale();
};